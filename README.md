# Django Menu App

Django приложение для создания и отображения древовидных меню.

## Возможности

- ✅ Меню реализовано через template tag
- ✅ Все пункты над выделенным пунктом развернуты
- ✅ Первый уровень вложенности под выделенным пунктом развернут
- ✅ Хранится в БД
- ✅ Редактируется в стандартной админке Django
- ✅ Активный пункт меню определяется исходя из URL текущей страницы
- ✅ На одной странице может быть несколько меню (определяются по названию)
- ✅ URL может быть задан как явным образом, так и через named URL
- ✅ На отрисовку каждого меню требуется ровно 1 запрос к БД

## Быстрый старт

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Выполните миграции:
```bash
python manage.py makemigrations
python manage.py migrate
```

3. Создайте суперпользователя для доступа к админке:
```bash
python manage.py createsuperuser
```

4. Запустите сервер разработки:
```bash
python manage.py runserver
```

5. Откройте админку: http://127.0.0.1:8000/admin/

6. Создайте меню и пункты меню через админку

7. Используйте в шаблонах:
```django
{% load menu_tags %}
{% draw_menu 'main_menu' %}
```

## Использование

### 1. Создание меню через админку

1. Запустите сервер разработки:
```bash
python manage.py runserver
```

2. Откройте админку: http://127.0.0.1:8000/admin/

3. Создайте меню:
   - Перейдите в раздел "Меню"
   - Нажмите "Добавить меню"
   - Введите название меню (например, `main_menu`)
   - Сохраните

4. Добавьте пункты меню:
   - В форме редактирования меню добавьте пункты через inline форму
   - Для каждого пункта укажите:
     - **Название пункта** - текст, который будет отображаться
     - **Родительский пункт** - выберите родителя для создания вложенности (оставьте пустым для корневого пункта)
     - **URL** - явный URL (например: `/page1/`) ИЛИ
     - **Named URL** - имя URL из urls.py (например: `page1`)
     - **Порядок сортировки** - число для сортировки пунктов

### 2. Использование в шаблонах

В вашем шаблоне загрузите template tag и используйте его:

```django
{% load menu_tags %}

{% draw_menu 'main_menu' %}
```

Где `'main_menu'` - это название меню, созданного в админке.

### 3. Пример структуры меню

Пример создания меню со следующей структурой:

```
Главная (/)
├── Страница 1 (/page1/)
├── Страница 2 (/page2/)
└── Раздел 1 (/section1/)
    ├── Подраздел 1 (/section1/subsection1/)
    └── Подраздел 2 (/section1/subsection2/)
```

**В админке создайте:**

1. Меню с названием `main_menu`

2. Пункты меню:
   - Главная (URL: `/`, порядок: 1)
   - Страница 1 (URL: `/page1/`, порядок: 2)
   - Страница 2 (URL: `/page2/`, порядок: 3)
   - Раздел 1 (URL: `/section1/`, порядок: 4)
   - Подраздел 1 (Родитель: Раздел 1, URL: `/section1/subsection1/`, порядок: 1)
   - Подраздел 2 (Родитель: Раздел 1, URL: `/section1/subsection2/`, порядок: 2)

### 4. Использование Named URL

Вместо явного URL можно использовать named URL из вашего `urls.py`:

```python
# urls.py
urlpatterns = [
    path('page1/', views.page1, name='page1'),
]
```

В админке для пункта меню укажите:
- **Named URL**: `page1`
- **URL**: оставьте пустым

### 5. Несколько меню на странице

Вы можете использовать несколько меню на одной странице:

```django
{% load menu_tags %}

<div class="sidebar">
    {% draw_menu 'main_menu' %}
</div>

<div class="footer-menu">
    {% draw_menu 'footer_menu' %}
</div>
```

## Логика работы

1. **Определение активного пункта**: Активный пункт определяется по совпадению URL текущей страницы с URL пункта меню.

2. **Развертывание меню**:
   - Все пункты на пути от корня до активного пункта развернуты
   - Первый уровень вложенности под активным пунктом также развернут

3. **Оптимизация запросов**: Для каждого меню выполняется ровно 1 запрос к БД с использованием `prefetch_related` для предзагрузки связанных объектов.

## Настройка стилей

По умолчанию меню использует базовые стили. Вы можете переопределить шаблоны:

- `menu/templates/menu/menu.html` - основной шаблон меню
- `menu/templates/menu/menu_item.html` - шаблон пункта меню

Или добавьте свои CSS классы в шаблоны.

## Структура проекта

```
django_menu/
├── manage.py
├── django_menu/
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── menu/
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── models.py
│   ├── templatetags/
│   │   ├── __init__.py
│   │   └── menu_tags.py
│   └── templates/
│       └── menu/
│           ├── menu.html
│           └── menu_item.html
└── templates/
    └── base.html
```

## Требования

- Django 3.2+
- Python 3.7+

## Лицензия

MIT

